<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Académie de Piano - Accueil</title>
    <link href="https://fonts.googleapis.com/css?family=Gochi+Hand|Arvo:400,700" rel="stylesheet">
    <link href="css/jquery.bxslider.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="css/sweetalert2.min.js"></script>
    <style>
        input[type=file]::file-selector-button {
            margin-right: 8px;
            border: none;
            background: #084cdf;
            padding: 8px 12px;
            color: #fff;
            cursor: pointer;
            outline: 5px dashed #000;
            outline-offset: 2px;
        }
    </style>
</head>

<body>
    <div id="wrapper" class="gallery">
        <div class="wrapper-holder">
            <header id="header">
                <div class="left-part"></div>
                <a id="logo" href="index.html"></a>
                <div class="bar-holder">
                    <a class="menu_trigger" href="#">Menu</a>
                    <nav id="nav">
                        <ul>
                            <li><a href="index.html">Accueil</a></li>
                            <li><a href="cours.html">Cours</a></li>
                            <li><a href="jeux.html">Jeux</a></li>
                            <li><a href="parametre.html">Paramètres</a></li>
                        </ul>
                    </nav>
                </div>
            </header>
            <div class="dvdr"></div>
            <div class="container">
                <section id="main">
                    <h1 style="text-align: center;">Paramètres</h1>
                    <div class="tabs">
                        <ul class="filter-controls">
                            <li><a href="#" onclick="showSection('avatar-section')">Avatar</a></li>
                            <li><a href="#" onclick="showSection('profil-section')">Profil</a></li>
                            <li><a href="#" onclick="showSection('progressions-section')">Progressions</a></li>
                        </ul>
                    </div>
                    <ul style="height: 60vh;">
                        <li class="section-content" id="avatar-section">
                            <ul class="slider sortable-grid">
                                <li>
                                    <ul>
                                        <li class="grid-item meeting"
                                            onclick="selectAvatar('images/img-meeting01.jpg')">
                                            <a href="#"><img src="images/img-meeting01.jpg" alt="" />
                                                <div class="mask"></div>
                                            </a>
                                        </li>
                                        <li class="grid-item meeting"
                                            onclick="selectAvatar('images/img-meeting02.jpg')">
                                            <a href="#"><img src="images/img-meeting02.jpg" alt="" />
                                                <div class="mask"></div>
                                            </a>
                                        </li>
                                        <li class="grid-item meeting"
                                            onclick="selectAvatar('images/img-meeting03.jpg')">
                                            <a href="#"><img src="images/img-meeting03.jpg" alt="" />
                                                <div class="mask"></div>
                                            </a>
                                        </li>
                                        <li class="grid-item meeting"
                                            onclick="selectAvatar('images/img-meeting04.jpg')">
                                            <a href="#"><img src="images/img-meeting04.jpg" alt="" />
                                                <div class="mask"></div>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                            <br>
                            <br>
                            <br>
                            <!-- <label for="ava">
                                <input type="file" class="btn yellow" value="" id="ava" accept="images/*">
                                <button type="button" onclick="getAvatar()">save</button>
                            </label> -->

                        </li>
                        <li class="section-content" id="profil-section">
                            <br><br>
                            <form id="profile-form" onsubmit="saveProfile(event)">
                                <div style="text-align: center;">
                                    <img src="" width="200px" height="200px" id="d-img" alt=""
                                        style="border-radius: 90px 90px 90px 90px;" />
                                </div>
                                <br>
                                <br>
                                <input type="text" id="nom" name="nom" placeholder="Entrez le nom de l'utilisateur...."
                                    required><br><br>
                                <input type="text" id="prenom" name="prenom"
                                    placeholder="Entrez le prenom de l'utilisateur...." required><br><br>
                                <input type="date" id="dateNaissance" name="dateNaissance" required><br><br>
                                <button class="btn yellow" href="#" type="submit">Enregistrer</button>
                            </form>
                        </li>
                        <li class="section-content" id="progressions-section">
                            <br>
                            <br>
                            <table border="1" class="table">
                                <thead>
                                    <tr class="tr">
                                        <th class="th"><b>Nom</b></th>
                                        <th class="th"><b>Prénom</b></th>
                                        <th class="th"><b>Date de Naissance</b></th>
                                    </tr>
                                    <tr class="tr">
                                        <th class="th"><span id="nomUser"></span></th>
                                        <th class="th"><span id="prenomUser"></span></th>
                                        <th class="th"><span id="dateNaissanceUser"></span></th>
                                    </tr>
                                    <tr class="tr">
                                        <th class="th">Apprentissage</th>
                                        <th class="th">Jeux</th>
                                        <th class="th">Quiz</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="tr">
                                        <td class="td">
                                            <span id="apprentissage-stat"></span>
                                        </td>
                                        <td class="td">
                                            <span id="jeu-stat"></span>
                                        </td>
                                        <td class="td">
                                            <span id="quiz-stat"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                    </ul>
                </section>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.bxslider.min.js"></script>
    <script type="text/javascript" src="js/jquery.placeholder.js"></script>
    <script type="text/javascript" src="js/imagesloaded.pkgd.min.js"></script>
    <script type="text/javascript" src="js/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>

    <script>
        function showSection(sectionId) {
            $('.section-content').removeClass('active');
            $('#' + sectionId).addClass('active');
        }


    </script>

    <script>
        let storedNom;
        let storedImg;
        let storedPrenom;
        let storedDateNaissance;
        let storedPerformances;
        let storedGamesHistory;
        let storedQuizSessions;
        let successRatioPerf = 0;
        let successRatioGame = 0;
        let successRatioQuiz = 0;

        $(document).ready(function () {
            fetchProfile();
        });

        function getAvatar() {
            var fileInput = document.getElementById('ava');
            var file = fileInput.files[0];
            console.log(file.path);

            if (file) {
                console.log("Selected file:", file.name);
                console.log("File type:", file.type);
                console.log("File size:", file.size, "bytes");

                // You can now use the File object, for example, to display the image
                var reader = new FileReader();
                reader.onload = function (e) {
                    console.log("File content:", e.target.result);
                    // You can display the image using e.target.result as the src
                    var img = document.createElement('img');
                    img.src = e.target.result;
                    document.body.appendChild(img);
                };

                console.log(reader.readAsDataURL(file))
                selectAvatar(reader.readAsDataURL(file))

            } else {
                console.log("No file selected");
            }
        }


        function fetchProfile() {
            storedImg = localStorage.getItem('avatar') || '';
            storedNom = localStorage.getItem('nom') || '--------';
            storedPrenom = localStorage.getItem('prenom') || '--------';
            storedDateNaissance = localStorage.getItem('dateNaissance') || '--------';
            storedPerformances = JSON.parse(localStorage.getItem('performance')) || [];
            storedGamesHistory = JSON.parse(localStorage.getItem('gamesHistory')) || [];
            storedQuizSessions = JSON.parse(localStorage.getItem('quizSessions')) || [];

            console.log(storedImg)

            // Calcul du ratio de réussite pour les performances
            if (storedPerformances.length > 0) {
                let successCount = storedPerformances.filter(item => item.success === true).length;
                let totalCount = storedPerformances.length;
                successRatioPerf = (successCount / totalCount) * 100;
            }

            // Calcul du ratio de réussite pour les quiz
            if (storedQuizSessions.length > 0) {
                let successCount = storedQuizSessions.filter(item => item.correct !== "Non").length;
                let totalCount = storedQuizSessions.length;
                successRatioQuiz = (successCount / totalCount) * 100;
            }

            // Calcul du ratio de réussite global des jeux
            let totalGames = storedGamesHistory.length;
            let totalProgress = 0;

            if (totalGames > 0) {
                storedGamesHistory.forEach(game => {
                    let totalAttempts = game.correctAttempts + game.wrongAttempts;
                    let percentageProgress = (game.correctAttempts / totalAttempts) * 100;
                    totalProgress += percentageProgress;
                });

                let globalPercentage = totalProgress / totalGames;
                successRatioGame = parseFloat(globalPercentage);
            }

            // Mise à jour de l'interface utilisateur avec les informations récupérées
            $('#nomUser').text(storedNom);
            $('#d-img').attr('src', './' + storedImg);

            $('#prenomUser').text(storedPrenom);
            $('#dateNaissanceUser').text(storedDateNaissance);
            $('#nom').val(storedNom);
            $('#prenom').val(storedPrenom);
            $('#dateNaissance').val(storedDateNaissance);

            $("#apprentissage-stat").text(successRatioPerf.toFixed(2) + "%");
            $("#jeu-stat").text(successRatioGame.toFixed(2) + "%");
            $("#quiz-stat").text(successRatioQuiz.toFixed(2) + "%");
        }

        function selectAvatar(avatarName) {
            Swal.fire({
                title: 'Confirmer la sélection',
                text: `Sélectionner cette image comme votre avatar ?`,
                showCancelButton: true,
                confirmButtonText: 'Continuer',
                cancelButtonText: 'Annuler'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.setItem('avatar', avatarName);
                    storedImg = localStorage.getItem('avatar');
                    $('#d-img').attr('src', './' + storedImg);
                    Swal.fire({
                        title: 'Sélectionné!',
                        text: `Image sélectionnée comme votre nouvel avatar.`,
                        confirmButtonText: 'Continuer'
                    });
                }
            });
        }

        function saveProfile(event) {
            event.preventDefault();
            const nom = $('#nom').val();
            const prenom = $('#prenom').val();
            const dateNaissance = $('#dateNaissance').val();

            Swal.fire({
                title: 'Confirmer Enregistrement',
                text: "Souhaitez-vous continuer vers l'enregistrement de ces informations ?",
                showCancelButton: true,
                confirmButtonText: 'Continuer',
                cancelButtonText: 'Annuler'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.setItem('nom', nom);
                    localStorage.setItem('prenom', prenom);
                    localStorage.setItem('dateNaissance', dateNaissance);

                    Swal.fire({
                        title: 'Profil enregistré !',
                        text: "Votre profil utilisateur a été enregistré avec succès.",
                        confirmButtonText: 'Continuer'
                    });

                    // Mettre à jour l'interface utilisateur avec les nouvelles informations
                    $('#nom').val(nom);
                    $('#prenom').val(prenom);
                    $('#dateNaissance').val(dateNaissance);
                    $('#nomUser').text(nom);
                    $('#prenomUser').text(prenom);
                    $('#dateNaissanceUser').text(dateNaissance);
                }
            });
        }
    </script>


</body>

</html>